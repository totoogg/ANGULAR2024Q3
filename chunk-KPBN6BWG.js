import{b as f,c as d,g as x,m as k,n as K,o as V,p as c,q as _}from"./chunk-3B7BV7GO.js";import{Ib as L,T as C,V as M,W as b,X as N,Y as h,Z as j,a as v,b as P,ba as F,da as q,ga as w,ra as D,sc as S,tc as G,uc as H,vc as A,wc as T,zc as Q}from"./chunk-NZHHZJHM.js";var J="@ngrx/router-store/request",mt=f(J,d()),y="@ngrx/router-store/navigation",Et=f(y,d()),O="@ngrx/router-store/cancel",vt=f(O,d()),z="@ngrx/router-store/error",Ct=f(z,d()),W="@ngrx/router-store/navigated",Nt=f(W,d());function St(e,t){let o=t;switch(o.type){case y:case z:case O:return{state:o.payload.routerState,navigationId:o.payload.event.id};default:return e}}var R=class{serialize(t){return{root:this.serializeRoute(t.root),url:t.url}}serializeRoute(t){let o=t.children.map(i=>this.serializeRoute(i));return{params:t.params,data:t.data,url:t.url,outlet:t.outlet,title:t.title,routeConfig:t.routeConfig?{path:t.routeConfig.path,pathMatch:t.routeConfig.pathMatch,redirectTo:t.routeConfig.redirectTo,outlet:t.routeConfig.outlet,title:typeof t.routeConfig.title=="string"?t.routeConfig.title:void 0}:null,queryParams:t.queryParams,fragment:t.fragment,firstChild:o[0],children:o}}},U=function(e){return e[e.PreActivation=1]="PreActivation",e[e.PostActivation=2]="PostActivation",e}(U||{}),X="router",B=new N("@ngrx/router-store Internal Configuration"),Y=new N("@ngrx/router-store Configuration");function rt(e){return v({stateKey:X,serializer:R,navigationActionTiming:U.PreActivation},e)}var m=class{serialize(t){return{root:this.serializeRoute(t.root),url:t.url}}serializeRoute(t){let o=t.children.map(i=>this.serializeRoute(i));return{params:t.params,paramMap:t.paramMap,data:t.data,url:t.url,outlet:t.outlet,title:t.title,routeConfig:t.routeConfig?{component:t.routeConfig.component,path:t.routeConfig.path,pathMatch:t.routeConfig.pathMatch,redirectTo:t.routeConfig.redirectTo,outlet:t.routeConfig.outlet,title:t.routeConfig.title}:null,queryParams:t.queryParams,queryParamMap:t.queryParamMap,fragment:t.fragment,component:t.routeConfig?t.routeConfig.component:void 0,root:void 0,parent:void 0,firstChild:o[0],pathFromRoot:void 0,children:o}}},E=class{},u=function(e){return e[e.NONE=1]="NONE",e[e.ROUTER=2]="ROUTER",e[e.STORE=3]="STORE",e}(u||{}),Z=(()=>{let t=class t{constructor(i,s,n,l,g,p){this.store=i,this.router=s,this.serializer=n,this.errorHandler=l,this.config=g,this.activeRuntimeChecks=p,this.lastEvent=null,this.routerState=null,this.trigger=u.NONE,this.stateKey=this.config.stateKey,!V()&&L()&&(p?.strictActionSerializability||p?.strictStateSerializability)&&this.serializer instanceof m&&console.warn("@ngrx/router-store: The serializability runtime checks cannot be enabled with the FullRouterStateSerializer. The FullRouterStateSerializer has an unserializable router state and actions that are not serializable. To use the serializability runtime checks either use the MinimalRouterStateSerializer or implement a custom router state serializer."),this.setUpStoreStateListener(),this.setUpRouterEventsListener()}setUpStoreStateListener(){this.store.pipe(K(this.stateKey),C(this.store)).subscribe(([i,s])=>{this.navigateIfNeeded(i,s)})}navigateIfNeeded(i,s){if(!i||!i.state||this.trigger===u.ROUTER||this.lastEvent instanceof S)return;let n=i.state.url;st(this.router.url,n)||(this.storeState=s,this.trigger=u.STORE,this.router.navigateByUrl(n).catch(l=>{this.errorHandler.handleError(l)}))}setUpRouterEventsListener(){let i=this.config.navigationActionTiming===U.PostActivation,s;this.router.events.pipe(C(this.store)).subscribe(([n,l])=>{this.lastEvent=n,n instanceof S?(this.routerState=this.serializer.serialize(this.router.routerState.snapshot),this.trigger!==u.STORE&&(this.storeState=l,this.dispatchRouterRequest(n))):n instanceof T?(s=n,!i&&this.trigger!==u.STORE&&this.dispatchRouterNavigation(n)):n instanceof H?(this.dispatchRouterCancel(n),this.reset()):n instanceof A?(this.dispatchRouterError(n),this.reset()):n instanceof G&&(this.trigger!==u.STORE&&(i&&this.dispatchRouterNavigation(s),this.dispatchRouterNavigated(n)),this.reset())})}dispatchRouterRequest(i){this.dispatchRouterAction(J,{event:i})}dispatchRouterNavigation(i){let s=this.serializer.serialize(i.state);this.dispatchRouterAction(y,{routerState:s,event:new T(i.id,i.url,i.urlAfterRedirects,s)})}dispatchRouterCancel(i){this.dispatchRouterAction(O,{storeState:this.storeState,event:i})}dispatchRouterError(i){this.dispatchRouterAction(z,{storeState:this.storeState,event:new A(i.id,i.url,`${i}`)})}dispatchRouterNavigated(i){let s=this.serializer.serialize(this.router.routerState.snapshot);this.dispatchRouterAction(W,{event:i,routerState:s})}dispatchRouterAction(i,s){this.trigger=u.ROUTER;try{this.store.dispatch({type:i,payload:P(v({routerState:this.routerState},s),{event:this.config.routerState===0?s.event:{id:s.event.id,url:s.event.url,urlAfterRedirects:s.event.urlAfterRedirects}})})}finally{this.trigger=u.NONE}}reset(){this.trigger=u.NONE,this.storeState=null,this.routerState=null}};t.\u0275fac=function(s){return new(s||t)(h(k),h(Q),h(E),h(D),h(Y),h(x))},t.\u0275prov=M({token:t,factory:t.\u0275fac});let e=t;return e})();function st(e,t){return $(e)===$(t)}function $(e){return e?.length>0&&e[e.length-1]==="/"?e.substring(0,e.length-1):e}function nt(e={}){return w([{provide:B,useValue:e},{provide:Y,useFactory:rt,deps:[B]},{provide:E,useClass:e.serializer?e.serializer:e.routerState===0?m:R},{provide:F,multi:!0,useFactory(){return()=>j(Z)}},Z])}var At=(()=>{let t=class t{static forRoot(i={}){return{ngModule:t,providers:[nt(i)]}}};t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=q({type:t}),t.\u0275inj=b({});let e=t;return e})();function ot(){return _(X)}function Tt(e=ot()){let t=c(e,r=>r&&r.state),o=c(t,r=>r&&r.root),i=c(o,r=>{if(!r)return;let a=r;for(;a.firstChild;)a=a.firstChild;return a}),s=c(o,r=>r&&r.fragment),n=c(o,r=>r&&r.queryParams),l=r=>c(n,a=>a&&a[r]),g=c(i,r=>r&&r.params),p=r=>c(g,a=>a&&a[r]),I=c(i,r=>r&&r.data),tt=r=>c(I,a=>a&&a[r]),et=c(t,r=>r&&r.url),it=c(i,r=>{if(r?.routeConfig)return typeof r.routeConfig.title=="string"?r.routeConfig.title:r.title});return{selectCurrentRoute:i,selectFragment:s,selectQueryParams:n,selectQueryParam:l,selectRouteParams:g,selectRouteParam:p,selectRouteData:I,selectRouteDataParam:tt,selectUrl:et,selectTitle:it}}export{St as a,At as b,Tt as c};
